<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!--=============== FLATICON ===============-->
    <link
      rel="stylesheet"
      href="https://cdn-uicons.flaticon.com/2.0.0/uicons-regular-straight/css/uicons-regular-straight.css"
    />

    <!--=============== SWIPER CSS ===============-->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
    />

    <!--=============== CSS ===============-->
    <link rel="stylesheet" href="./assets/css/styles.css" />

    <title>Ecommerce Website</title>
  </head>
  <body>
    <style>
      .add-discount-btn {
        display: flex; /* Sử dụng flexbox */
        justify-content: flex-start; /* Căn chỉnh nút về phía bên phải */
        margin-bottom: 20px; /* Khoảng cách dưới nút */
      }

      .add-discount-btn .button {
        background-color: var(--first-color); /* Màu nền */
        color: white; /* Màu chữ */
        font-size: 16px; /* Kích thước chữ */
        padding: 10px 20px; /* Khoảng cách bên trong */
        border-radius: 4px; /* Bo tròn góc */
        text-decoration: none; /* Bỏ gạch chân */
        display: inline-block; /* Để nút nằm trên cùng một dòng */
      }

      .add-discount-btn .button:hover {
        background-color: #054c2a; /* Màu nền khi di chuột qua */
      }

      .discount-table {
        width: 105%;
        border-collapse: collapse;
        margin-top: 20px;
      }

      .discount-table th,
      .discount-table td {
        border: 1px solid #ccc;
        padding: 10px 10px;
        text-align: center;
      }

      .discount-table th {
        background-color: #e0e0e0;
        font-weight: bold; /* Làm cho chữ trong th đậm hơn */
      }
      .discount-button {
        color: white; /* Màu chữ */
        background-color: var(--first-color); /* Màu nền */
        padding: 5px 10px;
        border-radius: 4px;
        border: none; /* Bỏ viền */
        cursor: pointer; /* Con trỏ chuột */
        margin: 0 5px; /* Khoảng cách giữa các nút */
      }

      .discount-button:hover {
        background-color: #054c2a; /* Màu nền khi di chuột qua */
      }

      .pagination {
    list-style: none;
    display: flex;
    justify-content: center; /* Căn giữa toàn bộ phân trang */
    margin-top: 20px;
}

.pagination__link {
    margin: 0 5px; /* Khoảng cách giữa các liên kết */
    padding: 10px 15px; /* Padding cho mỗi ô */
    border: 1px solid #ccc; /* Viền cho mỗi ô */
    cursor: pointer; /* Con trỏ khi hover */
    color: #000; /* Màu chữ */
    text-align: center; /* Căn giữa văn bản trong ô */
    border-radius: 4px; /* Bo góc cho các ô */
    display: flex; /* Thay đổi để sử dụng Flexbox */
    align-items: center; /* Căn giữa theo chiều dọc */
    justify-content: center; /* Căn giữa theo chiều ngang */
}

.pagination__link.active {
    background-color: var(--first-color); /* Màu nền cho ô đang hoạt động */
    color: white; /* Màu chữ cho ô đang hoạt động */
}

.pagination__link:hover {
    background-color: #e0e0e0; /* Nền khi di chuột */
}
/* Thay đổi độ rộng của cột thao tác */
table th:last-child, table td:last-child {
    width: 150px; /* Đặt chiều rộng cột thao tác */
}

.discount-table input {
    width: 100%; /* Chiếm toàn bộ chiều rộng của ô */
    border: none; /* Bỏ viền */
    outline: none; /* Bỏ viền khi focus */
}
.pagination__dots {
    position: relative;
    top: 15px; /* Điều chỉnh giá trị này để di chuyển dấu "..." xuống hoặc lên */
    font-size: 14px; /* Đảm bảo dấu "..." có kích thước tương đương các số trang */
    color: black;
}
.edit-icon, .trash-icon, .tick-icon {
    color: gray; /* Màu xám cho biểu tượng */
    transition: color 0.3s; /* Hiệu ứng chuyển màu mượt mà */
}

.edit-icon:hover, .trash-icon:hover, .tick-icon:hover {
    color: red; /* Màu đỏ khi di chuột qua */
}
button {
    cursor: pointer; /* Đặt con trỏ chuột thành hình bàn tay cho tất cả các nút */
}
.search-container {
    display: flex; /* Sử dụng Flexbox để căn chỉnh các phần tử */
    align-items: center; /* Căn giữa theo chiều dọc */
    gap: 10px; /* Khoảng cách giữa các phần tử */
}

#search-input,
#filter-input {
    padding: 5px; /* Khoảng cách bên trong cho ô tìm kiếm và ô lọc */
    border: 1px solid #ccc; /* Viền cho ô tìm kiếm và ô lọc */
    border-radius: 4px; /* Bo góc cho ô tìm kiếm và ô lọc */
    flex: 1; /* Chiếm hết không gian còn lại */
}

#apply-button {
    border: 2px solid red; /* Khung viền đỏ */
    background-color: transparent; /* Không có màu nền */
    color: red; /* Chữ màu đỏ */
    padding: 5px 10px; /* Khoảng cách bên trong */
    cursor: pointer; /* Con trỏ chuột khi di chuột qua */
}

#reset-button {
    background-color: black; /* Màu nền đen */
    color: white; /* Chữ màu trắng */
    margin-left: 10px; /* Khoảng cách giữa hai nút */
    padding: 5px 10px; /* Khoảng cách bên trong */
    cursor: pointer; /* Con trỏ chuột khi di chuột qua */
}


    </style>

    <!--=============== HEADER ===============-->
    <nav class="nav container">
      <a href="index-manage.html" class="nav__logo">
        <img
          class="nav__logo-img"
          src="assets/img/logo.png"
          alt="website logo"
        />
      </a>
      <div class="nav__menu" id="nav-menu">
        <div class="nav__menu-top">
          <a href="index-manage.html" class="nav__menu-logo">
            <img src="./assets/img/logo.png" alt="" />
          </a>
          <div class="nav__close" id="nav-close">
            <i class="fi fi-rs-cross-small"></i>
          </div>
        </div>
        <ul class="nav__list">
          <li class="nav__item">
            <a href="productManage.html" class="nav__link">Quản lý Sản phẩm</a>
          </li>
          <li class="nav__item">
            <a href="quanlydonhang.html" class="nav__link">Quản lý Đơn hàng</a>
          </li>
          <li class="nav__item">
            <a href="discount.html" class="nav__link active-link">Quản lý khuyến mãi</a>
          </li>
          <li class="nav__item">
            <a href="accounts-manager.html" class="nav__link">Thông tin</a>
          </li>
        </ul>
      </div>
    </nav>
    <!--=============== MAIN ===============-->
    <main class="main">
      <!--=============== Promotion Management ===============-->
      <section class="products container section--lg">
        <div class="search-container">
          <input type="text" id="search-input" placeholder="Tìm kiếm...">
          <input type="text" id="filter-input" placeholder="Lọc..."> <!-- Ô lọc -->
          <button id="apply-button">Áp dụng</button>
          <button id="reset-button">Nhập lại</button>
      </div>
      <br>
        <div class="add-discount-btn">
          <a href="add-Discount.html" class="button">
            <i class="fi fi-rs-plus"></i> Thêm 1 mã khuyến mãi mới
          </a>
          <br />
        </div>

        <table class="discount-table">
          <thead>
            <tr>
              <th>Tên mã</th>
              <th>Mã khuyến mãi</th>
              <th>Số lượng</th>
              <th>Giảm theo phần trăm</th>
              <th>Giảm theo vnđ</th>
              <th>Giá trị đơn hàng tối thiểu</th>
              <th>Số tiền giảm tối đa</th>
              <th>Khoảng thời gian áp dụng</th>
              <th>Thao tác</th>
            </tr>
          </thead>
          <tbody id="promo-table-body">
            <!-- Nội dung sẽ được thêm bằng JavaScript -->
          </tbody>
        </table>

        <ul class="pagination" id="pagination">
          <!-- Nội dung sẽ được thêm bằng JavaScript -->
        </ul>
      </section>
    </main>

    <!--=============== FOOTER ===============-->
    <footer class="footer container">
      <div class="footer__container grid">
        <div class="footer__content">
          <a href="index.html" class="footer__logo">
            <img src="./assets/img/logo.png" alt="" class="footer__logo-img" />
          </a>
          <h4 class="footer__subtitle">Thông tin liên hệ</h4>
          <p class="footer__description">
            <span>Địa chỉ:</span> Công ty CP-TM-DV Xe Gắn Máy, 100 phường Đông Hòa, TP. Dĩ An, tỉnh Bình Dương, Việt Nam.
          </p>
          <p class="footer__description">
            <span>Hotline:</span> +84 001 929 992
          </p>
          <p class="footer__description">
            <span>Email:</span> contact@motorcycle.vn
          </p>
          <div class="footer__social">
            <h4 class="footer__subtitle">MotorCycle đã có mặt trên:</h4>
            <div class="footer__links flex">
              <a href="#">
                <img
                  src="./assets/img/icon-facebook.svg"
                  alt=""
                  class="footer__social-icon"
                />
              </a>
              <a href="#">
                <img
                  src="./assets/img/icon-twitter.svg"
                  alt=""
                  class="footer__social-icon"
                />
              </a>
              <a href="#">
                <img
                  src="./assets/img/icon-instagram.svg"
                  alt=""
                  class="footer__social-icon"
                />
              </a>
              <a href="#">
                <img
                  src="./assets/img/icon-pinterest.svg"
                  alt=""
                  class="footer__social-icon"
                />
              </a>
              <a href="#">
                <img
                  src="./assets/img/icon-youtube.svg"
                  alt=""
                  class="footer__social-icon"
                />
              </a>
            </div>
          </div>
        </div>
        <div class="footer__content">
          <h3 class="footer__title">Thông tin chi tiết</h3>
          <ul class="footer__links">
            <li><a href="#" class="footer__link">Về chúng tôi</a></li>
            <li><a href="#" class="footer__link">Chính sách giao hàng</a></li>
            <li><a href="#" class="footer__link">Điều khoản bảo mật</a></li>
            <li><a href="#" class="footer__link">Quy định cung cấp dịch vụ</a></li>
          </ul>
        </div>
        <div class="footer__content">
          <h3 class="footer__title">Tải khoản của tôi</h3>
          <ul class="footer__links">
            <li><a href="#" class="footer__link">Đăng nhập</a></li>
            <li><a href="#" class="footer__link">Xem giỏ hàng</a></li>
            <li><a href="#" class="footer__link">Danh sách sản phẩm yêu thích</a></li>
            <li><a href="#" class="footer__link">Lịch sử đơn hàng</a></li>
          </ul>
        </div>
      </div>
    </footer>

    <script>
let currentPage = 1;
const itemsPerPage = 10; // Số lượng sản phẩm hiển thị trên mỗi trang
const promotions = [];

// Hàm để sinh dữ liệu cho các mã khuyến mãi
function generatePromotions(num) {
    for (let i = 1; i <= num; i++) {
        const discountPercentage = Math.floor(Math.random() * 101); // Giảm ngẫu nhiên từ 0% đến 100%
        const discountVND = Math.floor(Math.random() * 1000000); // Giảm ngẫu nhiên từ 0 đến 1.000.000 VNĐ
        const minOrderValue = Math.floor(Math.random() * 2000000); // Giá trị đơn hàng tối thiểu ngẫu nhiên
        const maxDiscountValue = Math.floor(Math.random() * 500000); // Số tiền giảm tối đa ngẫu nhiên

        const promo = {
            name: `Khuyến mãi ${i}`,
            code: `PROMO${i.toString().padStart(3, '0')}`, // Mã khuyến mãi sẽ có dạng PROMO001, PROMO002,...
            usageCount: Math.floor(Math.random() * 300), // Số lượt sử dụng ngẫu nhiên từ 0 đến 299
            discountPercentage: discountPercentage + '%', // Giảm theo phần trăm
            discountVND: discountVND.toLocaleString('vi-VN'), // Giảm theo VNĐ (định dạng với dấu phẩy)
            minOrderValue: minOrderValue.toLocaleString('vi-VN'), // Giá trị đơn hàng tối thiểu
            maxDiscountValue: maxDiscountValue.toLocaleString('vi-VN'), // Số tiền giảm tối đa
            date: `01/11/2024 - ${new Date(2024, 10, i % 30 + 1).toLocaleDateString('en-GB')}` // Ngày áp dụng
        };
        promotions.push(promo);
    }
}

// Gọi hàm để sinh 100 mã khuyến mãi
generatePromotions(100);

let filteredPromotions = promotions; // Biến lưu trữ danh sách đã lọc

function changePage(page) {
    currentPage = page;
    renderTable();
    renderPagination();
}

function renderTable() {
    const tableBody = document.getElementById('promo-table-body');
    tableBody.innerHTML = '';

    const start = (currentPage - 1) * itemsPerPage;
    const end = start + itemsPerPage;
    const paginatedItems = filteredPromotions.slice(start, end);

    paginatedItems.forEach(promotion => {
        const row = `
            <tr>
                <td>${promotion.name}</td>
                <td>${promotion.code}</td>
                <td>${promotion.usageCount}</td>
                <td>${promotion.discountPercentage}</td>
                <td>${promotion.discountVND} VNĐ</td>
                <td>${promotion.minOrderValue} VNĐ</td>
                <td>${promotion.maxDiscountValue} VNĐ</td>
                <td>${promotion.date}</td>
                <td>
                    <button onclick="editPromotion(this.closest('tr'))">
                        <i class="fi fi-rs-edit edit-icon"></i>
                    </button>
                    <button onclick="deletePromotion('${promotion.code}')">
                        <i class="fi fi-rs-trash trash-icon"></i>
                    </button>
                </td>
            </tr>
        `;
        tableBody.insertAdjacentHTML('beforeend', row);
    });
}

function deletePromotion(code) {
    const promoIndex = promotions.findIndex(promo => promo.code === code);
    if (promoIndex > -1) {
        promotions.splice(promoIndex, 1);
        filteredPromotions = promotions; // Cập nhật danh sách đã lọc
        renderTable();
        renderPagination();
    }
}

function renderPagination() {
    const pagination = document.getElementById('pagination');
    pagination.innerHTML = '';

    const totalPages = Math.ceil(filteredPromotions.length / itemsPerPage);

    // Nút lùi về
    if (currentPage > 1) {
        const prevButton = document.createElement('li');
        prevButton.innerHTML = `<a href="#" class="pagination__link" onclick="goToPage(${currentPage - 1})">«</a>`;
        pagination.appendChild(prevButton);
    }

    // Trang đầu tiên
    const firstPage = document.createElement('li');
    firstPage.innerHTML = `<a href="#" class="pagination__link ${currentPage === 1 ? 'active' : ''}" onclick="goToPage(1)">1</a>`;
    pagination.appendChild(firstPage);

    // Dấu ba chấm nếu cần
    if (currentPage > 3) {
        const dots = document.createElement('li');
        dots.innerHTML = `<span class="pagination__dots">...</span>`;
        pagination.appendChild(dots);
    }

    // Hiển thị các trang xung quanh trang hiện tại
    for (let i = Math.max(2, currentPage - 1); i <= Math.min(totalPages - 1, currentPage + 1); i++) {
        const pageItem = document.createElement('li');
        pageItem.innerHTML = `<a href="#" class="pagination__link ${currentPage === i ? 'active' : ''}" onclick="goToPage(${i})">${i}</a>`;
        pagination.appendChild(pageItem);
    }

    // Dấu ba chấm trước trang cuối
    if (currentPage < totalPages - 2) {
        const dots = document.createElement('li');
        dots.innerHTML = `<span class="pagination__dots">...</span>`;
        pagination.appendChild(dots);
    }

    // Trang cuối
    if (totalPages > 1) {
        const lastPage = document.createElement('li');
        lastPage.innerHTML = `<a href="#" class="pagination__link ${currentPage === totalPages ? 'active' : ''}" onclick="goToPage(${totalPages})">${totalPages}</a>`;
        pagination.appendChild(lastPage);
    }

    // Nút tiến tới
    if (currentPage < totalPages) {
        const nextButton = document.createElement('li');
        nextButton.innerHTML = `<a href="#" class="pagination__link" onclick="goToPage(${currentPage + 1})">»</a>`;
        pagination.appendChild(nextButton);
    }
}

// Hàm đi tới trang mong muốn
function goToPage(page) {
    if (page >= 1 && page <= Math.ceil(filteredPromotions.length / itemsPerPage)) {
        currentPage = page;
        renderTable();
        renderPagination();
    }
}

// Khởi động trang đầu tiên
renderTable();
renderPagination();

let originalRowData = null; // Biến lưu trữ dữ liệu gốc
let currentEditingRow = null; // Biến lưu trữ hàng đang chỉnh sửa

function editPromotion(row) {
    const cells = row.querySelectorAll('td');

    // Nếu đã có hàng đang chỉnh sửa thì lưu lại hàng đó
    if (currentEditingRow && currentEditingRow !== row) {
        savePromotion(currentEditingRow);
    }

    // Kiểm tra nếu hàng đang chỉnh sửa đã được nhấn lại
    if (currentEditingRow === row) {
        // Lưu lại nếu nhấn lại hàng đang chỉnh sửa
        savePromotion(row);
    } else {
        // Lưu dữ liệu gốc
        originalRowData = Array.from(cells).map(cell => cell.innerHTML);

        // Chuyển đổi về chế độ chỉnh sửa
        cells.forEach((cell, index) => {
            if (index < cells.length - 1) { // Không chỉnh sửa cột thao tác
                const input = `<input type="text" value="${cell.innerHTML}" />`;
                cell.innerHTML = input; // Thay thế bằng input
            }
        });

        // Cập nhật nút về "Lưu" với biểu tượng tick và ẩn nút chỉnh sửa
        const editButton = row.querySelector('button:first-child');
        editButton.innerHTML = `<i class="fi fi-rs-check tick-icon"></i>`; // Thay đổi biểu tượng thành tick
        currentEditingRow = row; // Lưu hàng đang chỉnh sửa
    }
}

// Hàm lưu chỉnh sửa
function savePromotion(row) {
    const cells = row.querySelectorAll('td');
    const isConfirmed = confirm('Bạn có chắc chắn muốn lưu các thay đổi?');

    if (isConfirmed) {
        cells.forEach((cell, index) => {
            if (index < cells.length - 1) { // Không chỉnh sửa cột thao tác
                const input = cell.querySelector('input');
                cell.innerHTML = input.value; // Lấy giá trị từ input
                // Cập nhật dữ liệu vào mảng promotions
                const promoCode = originalRowData[1]; // Mã khuyến mãi
                if (index === 0) promotions.find(p => p.code === promoCode).name = input.value; // Cập nhật tên
                if (index === 3) promotions.find(p => p.code === promoCode).discountPercentage = input.value; // Cập nhật phần trăm giảm
                if (index === 4) promotions.find(p => p.code === promoCode).discountVND = input.value; // Cập nhật giá trị giảm
                if (index === 5) promotions.find(p => p.code === promoCode).minOrderValue = input.value; // Cập nhật giá trị đơn hàng tối thiểu
                if (index === 6) promotions.find(p => p.code === promoCode).maxDiscountValue = input.value; // Cập nhật số tiền giảm tối đa
                if (index === 7) promotions.find(p => p.code === promoCode).date = input.value; // Cập nhật ngày
            }
        });
    } else {
        // Nếu không xác nhận, khôi phục dữ liệu ban đầu
        resetRow(row);
    }

    // Khôi phục nút chỉnh sửa
    const editButton = row.querySelector('button:first-child');
    editButton.innerHTML = '<i class="fi fi-rs-edit edit-icon"></i>'; // Đặt lại biểu tượng chỉnh sửa
    currentEditingRow = null; // Đặt trạng thái về mặc định
}

// Hàm khôi phục lại dữ liệu
function resetRow(row) {
    const cells = row.querySelectorAll('td');
    cells.forEach((cell, index) => {
        if (index < cells.length - 1) { // Không chỉnh sửa cột thao tác
            cell.innerHTML = originalRowData[index]; // Khôi phục lại giá trị ban đầu
        }
    });
    // Cập nhật lại nút về "Chỉnh sửa"
    const editIcon = row.querySelector('.edit-icon');
    editIcon.innerHTML = '<i class="fi fi-rs-edit edit-icon"></i>';
}

// Khởi động trang đầu tiên
renderTable();
renderPagination();

const searchInput = document.getElementById('search-input');

document.getElementById('apply-button').addEventListener('click', function() {
    const searchValue = document.getElementById('search-input').value.toLowerCase();
    const filterValue = document.getElementById('filter-input').value.toLowerCase();

    // Cập nhật danh sách đã lọc
    filteredPromotions = promotions.filter(promo => {
        return promo.name.toLowerCase().includes(searchValue) &&
               promo.code.toLowerCase().includes(filterValue);
    });

    // Đặt lại trang hiện tại
    currentPage = 1;

    // Cập nhật bảng với danh sách khuyến mãi đã lọc
    renderTable();
    renderPagination();
});

// Thêm sự kiện lắng nghe cho nút "Nhập lại"
document.getElementById('reset-button').addEventListener('click', function() {
    document.getElementById('search-input').value = ''; // Xóa ô tìm kiếm
    document.getElementById('filter-input').value = ''; // Xóa ô lọc
    filteredPromotions = promotions; // Hiển thị lại tất cả khuyến mãi
    currentPage = 1; // Đặt lại trang hiện tại
    renderTable(); // Hiển thị lại bảng
    renderPagination(); // Cập nhật phân trang
});

// Khởi động trang đầu tiên
renderTable();
renderPagination();



</script>
  </body>
</html>
